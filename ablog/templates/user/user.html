{% extends 'base.html' %}
{% from 'bootstrap/pagination.html' import render_pagination %}

{% block title %}{{ user.username }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="profile-header">
        <h1 class="display-3" >{{ user.username }}</h1>
        <p>Member since {{ moment(user.create_time).format('L') }}. Last seen {{ moment(user.last_seen).fromNow() }}.</p>
        <p>{{ user.posts.count() }} blog posts. {{ user.comments.count() }} comments.</p>
        <p>
            {% if current_user !=  user %}
            {% if not current_user|is_follow(user.username) %}
                <form class="inline" method="post"
                    action="{{ url_for('user.follow', user_id=user.id, next=request.full_path) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-primary btn-sm">
                        Follow
                    </button>
                </form>
            {% else %}
                <form class="inline" method="post"
                    action="{{ url_for('user.unfollow', user_id=user.id, next=request.full_path) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-danger btn-sm">
                        Unfollow
                    </button>
                </form>
            {% endif %}
            {% endif %}
            <a href="{{ url_for('user.followers', user_id=user.id) }}">Followers: <span class="badge">{{ user.follower.count() }}</span></a>
            <a href="{{ url_for('user.followed_by', user_id=user.id) }}">Following: <span class="badge">{{ user.followed.count() }}</span></a>
            {% if current_user.is_authenticated and user != current_user and user.is_following(current_user) %}
            | <span class="label label-default">Follows you</span>
            {% endif %}
        </p>
    </div>
</div>
<h3>Posts by {{ user.username }}</h3>
{% include 'post/_posts.html' %}
{% if posts %}
    <div class="page-footer">{{ render_pagination(pagination) }}</div>
{% endif %}
{% endblock %}